---
title: "920MHzに比べると国技館のBluetoothはカスや"
emoji: "🛜"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: [Arduino, 無線通信, ロボコン, ]
published: false
---

<< 前：[学生向けFixstars高速化コンテスト2024参加記]() by [kogetsu0728](https://qiita.com/kogetsu0728)  
\>\> 後：[KotlinでBukkitプラグインを書く]() by [toma09to](https://qiita.com/toma09to)

[木更津高専 Advent Calendar 2024](https://qiita.com/advent-calendar/2024/nit_kisarazu) 14日目担当のこかすた〜です。今年2回目の登場です。  

# はじめに
木更津高専ロボット研究同好会は、高専ロボコン2024 全国大会でデザイン賞を受賞しました！！
https://x.com/kokastar_dev/status/1858106528357925056

そして、今年は無線通信にIM920sLを使用した無線通信を導入しました。今回は、そのチュートリアル的な記事を書きます。

## この記事を読む前に
偉そうに記事を書いていますが、僕も今年が初めて使用したため、全ての機能を使えるようになっているわけではありません。そのため、「とりあえずこれで国技館で動いたよ～」という話になっています。  
もしより良いモードをご存じの方がいたら、是非コメントで教えていただけると幸いです。

## 「Bluetoothはカスや」の真意
人込みの中でイヤホンを使っていたら接続が悪くなった経験はないでしょうか? これは、混線が発生しているためです。  
Bluetoothが使用する2.4GHz帯というのはスマートフォンをはじめとする様々な機器で使用されています。しかし、その割にチャンネル数が少ないため、混線しやすいのです。これは国技館でも例外ではなく、これが原因でロボットが正常に動作せずに敗退してしまうチームもいます。これが、「Bluetoothはカスや」の真意です。  

この記事は、そんな2.4GHz帯の混線の代表格ともいえるBluetoothから脱却したい人たちの参考にしてもらうために書きました。

## 920MHz帯の概要
920MHz帯は、特定小電力無線として免許不要で使用できる周波数帯(315MHz, 400MHz, 920MHz, 1200MHz)の1つです。特徴として、400MHzや2.4GHzよりも広い帯域であることや、伝送距離が長いことがあります。  
920MHz帯全てが免許不要であるわけではなく、[いくつかの区分に分かれています](https://www.tele.soumu.go.jp/j/adm/system/ml/920mhz/index.htm)が、今回紹介するIM920sLは免許不要で使用できます。

また、送信時間や休止時間にルールが定められており、IM920sLは
 - 4秒の間に連続した50ミリ秒以上の送信休止時間が必要
 - 1時間の間に6分間使用可能で、送信後2ミリ秒休止する

の2種類が使用可能です。後者は試合時間を考えるとロボコンでの使用は現実的ではないため、この記事では前者を紹介します。そのため、送信中50msの休止時間が入ることになります。

## IM920sLとは?
[IM920sL](https://www.interplan.co.jp/solution/wireless/im920sl/)とは、interplan社から販売されてる無線モジュールで、920MHz帯を使用して通信します。扱うのが簡単なので、高専ロボコンでも様々なチームが採用しています。  
UARTを使ってコマンドを送ることで使用できます。

# 今回作るもの
今回は、Arduino間で一方向に数字を送信するプログラムを作成していきます。  
これを応用することで、
1. コントローラーの入力をマイコンで受け取り(USB Host Shield等)、数字に変換
2. IM920sL(コントローラー側)で送信
3. IM920sL(ロボット側)で受信
4. 数字から入力データに変換する。

という流れで920MHz対応ができます。

## 準備するもの
全部マルツで買えます。
## IM920sL
今回使う無線モジュールです。モジュールにはユニークなIDが書いてあり、これを使って相手を識別してペアリングを行います。  
![img.png](/images/im920sL_better/im920sl.png)

## 変換アダプタ
IM920sLの変換アダプタです。IM無線シールドとの接続に使うほか、ブレッドボードに刺して使うときなどにも使える気がします。
![img.png](/images/im920sL_better/convert-adapter.png)

## IM無線シールド
変換アダプタをArduino UNOに刺せるようになります。  
ノイズの関係もあるので避けるべきですが、IM920sL/変換アダプタに高さがあるので、普通のHost Shieldはこの上に重ねることができません。
![img.png](/images/im920sL_better/IM-Shield.png)

## USBインターフェースボード
Im920sLとPCの間でUSBを使ったシリアル通信ができるようになります。これは2個あると良いです。  
これがなくても、変換アダプタのピンとUSBのRX/TXを適切につなぐことで書き込めますし、Arduinoからコマンドを送る方法でも代用できます。ただ、USBで繋げたほうがペアリング等で楽です。

## A to MiniBケーブル
USBインターフェースボードとPCを接続するために使用するケーブルです。Nucleoとの通信で使うぐらいの中々使わない規格です。僕は、秋葉原の最終処分場で100円だったかで買いました。

## Tera Term
シリアル通信のターミナルと言ったら定番のソフトです。シリアル通信をします。[ここ](https://github.com/TeraTermProject/teraterm/releases)からダウンロードできます。  
Linuxの方もたくさんいると思いますので、そのような方は各自で準備していただければと思います。

# IM920sLをペアリングする
まずは、IM920sLをUSBインターフェースボードに取り付けます。変換アダプタをつけてもつけなくても取り付けられるような仕様になっています。

取り付けたら、USBをPCと接続します。その後、Tera Termで「設定」→「シリアルポート」と進み、以下の設定にします。

|  項目    | 値       | 
| -------------- | -------------- |
| ポート          | 接続したポート |
| スピード       | 19200          |
| データ         | 8bit           |
| パリティ       | none           |
| ストップビット | 1bit           |
| フロー制限     | none          |

# ArduinoにIM920sLを取り付ける

# Arduinoで通信を実装する